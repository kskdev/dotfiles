# Vim Configuration

macOS および Linux 向けの Vim 設定ファイル

## 特徴

- **dein.vim TOML 形式** によるプラグイン管理
- **遅延読み込み** による高速起動
- **機能別モジュール分離** で保守性向上

## ファイル構成

```
Vim/
├── vimrc              # エントリポイント
├── vimrc_alone        # 旧版（単一ファイル版）※参照用
├── dein/
│   ├── plugins.toml   # 即時読み込みプラグイン
│   └── lazy.toml      # 遅延読み込みプラグイン
├── rc/
│   ├── options.vim    # 基本設定
│   ├── lsp.vim        # LSP設定
│   ├── completion.vim # 補完設定 (ddc)
│   ├── fzf.vim        # FZF設定
│   ├── fern.vim       # ファイラ設定
│   └── lightline.vim  # ステータスライン設定
├── build_vim.sh       # Vimビルドスクリプト (Linux)
└── install.sh         # インストールスクリプト
```

## 前提条件

### 必須ツール

| ツール  | 用途                      |
| ------- | ------------------------- |
| git     | dein.vim のクローン       |
| deno    | ddc.vim (補完プラグイン)  |
| fzf     | ファジー検索              |
| ripgrep | 高速 grep (`:Rg`コマンド) |

### macOS

```bash
brew install git fzf ripgrep deno
```

### Linux (apt)

```bash
sudo apt install git fzf ripgrep
curl -fsSL https://deno.land/install.sh | sh  # deno
```

## インストール方法

```bash
cd dotfiles/Vim
./install.sh
```

vim を起動すると dein.vim が自動でプラグインをインストール

---

## キーマッピング

### Leader キー

`<Space>` を Leader キーとして使用

### FZF (ファジー検索)

| キー             | 動作       | 説明                   |
| ---------------- | ---------- | ---------------------- |
| `<Space>f`       | `:Files`   | ファイル検索           |
| `<Space>a`       | `:Rg`      | Ripgrep でテキスト検索 |
| `<Space>s`       | `:BLines`  | 現在のバッファ内検索   |
| `<Space>d`       | `:Buffers` | 開いているバッファ一覧 |
| `<Space>q`       | `:History` | 最近開いたファイル履歴 |
| `<Space>w`       | `:Marks`   | マーク一覧             |
| `<C-f>` (Insert) | パス補完   | ファイルパス補完       |

### LSP (Language Server Protocol)

| キー | 動作             | 説明                           |
| ---- | ---------------- | ------------------------------ |
| `gh` | `:LspHover`      | カーソル位置のシンボル情報表示 |
| `gd` | `:LspDefinition` | 定義元へジャンプ               |
| `gr` | `:LspRename`     | シンボル名を一括置換           |

### ファイラ (Fern)

| キー    | 動作             | 説明                      |
| ------- | ---------------- | ------------------------- |
| `<C-n>` | `:Fern`          | ファイラをトグル表示      |
| `q`     | 閉じる           | ファイラを閉じる          |
| `<C-x>` | 水平分割         | ファイルを水平分割で開く  |
| `<C-v>` | 垂直分割         | ファイルを垂直分割で開く  |
| `y`     | パスをヤンク     | ファイルパスをコピー      |
| `c`     | コピー           | ファイルをコピー          |
| `m`     | 移動             | ファイルを移動            |
| `d`     | 新規ディレクトリ | ディレクトリ作成          |
| `f`     | 新規ファイル     | ファイル作成              |
| `x`     | 削除             | ファイル/ディレクトリ削除 |
| `h`     | 隠しファイル     | 表示/非表示トグル         |

### Git (vim-gitgutter)

| キー    | 動作      | 説明                   |
| ------- | --------- | ---------------------- |
| `<C-f>` | 次の hunk | 次の変更箇所へジャンプ |
| `<C-d>` | 前の hunk | 前の変更箇所へジャンプ |

### 移動・検索

| キー                  | 動作         | プラグイン     | 説明                           |
| --------------------- | ------------ | -------------- | ------------------------------ |
| `ss`                  | EasyMotion   | vim-easymotion | 2 文字入力で任意位置へジャンプ |
| `n` / `N`             | 検索         | vim-anzu       | マッチ数を表示しながら検索移動 |
| `j` / `k`             | 高速移動     | accelerated-jk | 押し続けると加速               |
| `f` / `F` / `t` / `T` | 文字ジャンプ | clever-f       | 行をまたいでジャンプ可能       |

### 編集補助

| キー         | 動作     | プラグイン        | 説明                      |
| ------------ | -------- | ----------------- | ------------------------- |
| `ga`         | 整列     | vim-easy-align    | 選択範囲を指定文字で整列  |
| `gcc`        | コメント | tcomment          | 行をコメント/アンコメント |
| `v` (Visual) | 選択拡張 | vim-expand-region | 選択範囲を段階的に拡張    |
| `V` (Visual) | 選択縮小 | vim-expand-region | 選択範囲を段階的に縮小    |

### 補完 (ddc.vim)

| キー      | 動作           | 説明                          |
| --------- | -------------- | ----------------------------- |
| `<Tab>`   | 次の候補       | 補完候補を下に移動            |
| `<S-Tab>` | 前の候補       | 補完候補を上に移動            |
| `<C-k>`   | スニペット展開 | neosnippet のスニペットを展開 |

### 置換 (vim-over)

| キー    | 動作           | 説明                         |
| ------- | -------------- | ---------------------------- |
| `<C-s>` | 置換開始       | プレビュー付き置換モード開始 |
| `sub`   | カーソル下置換 | カーソル下の単語を置換       |

### その他

| キー    | 動作           | 説明                 |
| ------- | -------------- | -------------------- |
| `jj`    | `<Esc>`        | ノーマルモードへ移行 |
| `<C-w>` | ウィンドウ切替 | 次のウィンドウへ移動 |
| `<Esc>` | ハイライト消去 | 検索ハイライトを消す |

---

## プラグイン一覧

### 即時読み込み (plugins.toml)

| プラグイン                   | 説明                                      |
| ---------------------------- | ----------------------------------------- |
| **dein.vim**                 | プラグインマネージャ                      |
| **awesome-vim-colorschemes** | カラースキーム集 (iceberg 使用)           |
| **lightline.vim**            | カスタマイズ可能なステータスライン        |
| **lightline-bufferline**     | タブラインにバッファ一覧表示              |
| **denops.vim**               | Deno 製 Vim プラグイン基盤 (ddc.vim 依存) |
| **vim-indent-guides**        | インデント幅を可視化                      |
| **vim-matchup**              | 対応括弧・構文のハイライトとジャンプ      |
| **vim-gitgutter**            | Git 差分を左端に表示                      |

### 遅延読み込み (lazy.toml)

#### LSP・補完

| プラグイン            | 読み込み     | 説明                         |
| --------------------- | ------------ | ---------------------------- |
| **vim-lsp**           | FileType     | LSP クライアント             |
| **vim-lsp-settings**  | vim-lsp 依存 | 言語サーバー自動インストール |
| **ddc.vim**           | InsertEnter  | 非同期補完エンジン           |
| **pum.vim**           | ddc 依存     | ポップアップメニュー表示     |
| **ddc-vim-lsp**       | ddc 依存     | LSP 経由の補完ソース         |
| **ddc-source-around** | ddc 依存     | 周辺単語補完                 |
| **ddc-source-file**   | ddc 依存     | ファイルパス補完             |
| **neosnippet.vim**    | InsertEnter  | スニペットエンジン           |
| **echodoc.vim**       | InsertEnter  | 関数シグネチャ表示           |

#### 検索・ファイラ

| プラグイン   | 読み込み | 説明                     |
| ------------ | -------- | ------------------------ |
| **fzf**      | コマンド | ファジーファインダー本体 |
| **fzf.vim**  | fzf 依存 | FZF 用 Vim コマンド群    |
| **fern.vim** | コマンド | ファイルエクスプローラ   |

#### 編集・移動

| プラグイン                 | 読み込み    | 説明                       |
| -------------------------- | ----------- | -------------------------- |
| **auto-pairs**             | InsertEnter | 括弧自動補完               |
| **vim-sandwich**           | キー入力    | 囲み文字の追加・削除・変更 |
| **tcomment_vim**           | キー入力    | コメントトグル             |
| **vim-easy-align**         | キー入力    | テキスト整列               |
| **vim-expand-region**      | キー入力    | 選択範囲の段階的拡張       |
| **accelerated-jk**         | キー入力    | j/k 移動の加速             |
| **clever-f.vim**           | キー入力    | f/t 移動の強化             |
| **vim-easymotion**         | キー入力    | 任意位置へのジャンプ       |
| **vim-anzu**               | キー入力    | 検索マッチ数表示           |
| **vim-visual-star-search** | キー入力    | ビジュアル選択で検索       |

#### Git・表示

| プラグイン              | 読み込み     | 説明                 |
| ----------------------- | ------------ | -------------------- |
| **vim-fugitive**        | コマンド     | Git 操作コマンド     |
| **vim-highlightedyank** | TextYankPost | ヤンク範囲ハイライト |
| **vim-over**            | コマンド     | プレビュー付き置換   |

---

## 旧版からの移行

`vimrc_alone` は旧版（単一ファイル版）として残した

新版に問題がある場合は旧版を使用可能

```bash
cp vimrc_alone ~/.vimrc
```
